version: '3.8'

services:
  # 1. 메인 앱 (Streamlit)
  memora-app:
    build: .
    container_name: memora_app
    restart: unless-stopped
    ports:
      - "8501:8501"
    volumes:
      # [수정됨] 현재 폴더(.) 전체를 컨테이너의 /app으로 매핑
      # 이제 main.py가 최상위에 있으므로 이렇게 해야 코드가 보입니다.
      - ./:/app
      
      # [중요] SQLite DB 파일 영구 보존 (호스트와 공유)
      # 이게 없으면 컨테이너 재시작할 때마다 회의록이 사라질 수 있습니다.
      - ./memora.db:/app/memora.db
      
      # [유지] 오디오/임시 파일 데이터
      - ./data:/app/data
      
    environment:
      - TZ=Asia/Seoul
      - OLLAMA_URL=http://ollama:11434
    depends_on:
      - ollama

  # 2. 로컬 AI (Ollama)
  ollama:
    image: ollama/ollama:latest
    container_name: memora_ollama
    restart: unless-stopped
    volumes:
      # 모델 데이터를 호스트 ./data/ollama 폴더에 저장
      - ./data/ollama:/root/.ollama
    ports:
      - "11434:11434"